<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
    <!-- Generated by javadoc (1.8.0_152-release) on Thu Mar 08 11:53:32 EST 2018 -->
    <title>AtomicFile</title>
    <meta name="date" content="2018-03-08">
    <link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
    <script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="AtomicFile";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";

</script>
<noscript>
    <div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
    <!--   -->
</a>
    <div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation
        links</a></div>
    <a name="navbar.top.firstrow">
        <!--   -->
    </a>
    <ul class="navList" title="Navigation">
        <li><a href="../../../../../overview-summary.html">Overview</a></li>
        <li><a href="package-summary.html">Package</a></li>
        <li class="navBarCell1Rev">Class</li>
        <li><a href="package-tree.html">Tree</a></li>
        <li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
        <li><a href="../../../../../index-files/index-1.html">Index</a></li>
        <li><a href="../../../../../help-doc.html">Help</a></li>
    </ul>
</div>
<div class="subNav">
    <ul class="navList">
        <li><a href="../../../../../com/google/android/exoplayer2/util/Assertions.html"
               title="class in com.google.android.exoplayer2.util"><span class="typeNameLink">Prev&nbsp;Class</span></a>
        </li>
        <li>
            <a href="../../../../../com/google/android/exoplayer2/util/AtomicFile.AtomicFileOutputStream.html"
               title="class in com.google.android.exoplayer2.util"><span class="typeNameLink">Next&nbsp;Class</span></a>
        </li>
    </ul>
    <ul class="navList">
        <li><a href="../../../../../index.html?com/google/android/exoplayer2/util/AtomicFile.html"
               target="_top">Frames</a></li>
        <li><a href="AtomicFile.html" target="_top">No&nbsp;Frames</a></li>
    </ul>
    <ul class="navList" id="allclasses_navbar_top">
        <li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
    </ul>
    <div>
        <script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->


        </script>
    </div>
    <div>
        <ul class="subNavList">
            <li>Summary:&nbsp;</li>
            <li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
            <li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
            <li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
            <li><a href="#method.summary">Method</a></li>
        </ul>
        <ul class="subNavList">
            <li>Detail:&nbsp;</li>
            <li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
            <li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
            <li><a href="#method.detail">Method</a></li>
        </ul>
    </div>
    <a name="skip.navbar.top">
        <!--   -->
    </a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
    <div class="subTitle">com.google.android.exoplayer2.util</div>
    <h2 title="Class AtomicFile" class="title">Class AtomicFile</h2>
</div>
<div class="contentContainer">
    <ul class="inheritance">
        <li>java.lang.Object</li>
        <li>
            <ul class="inheritance">
                <li>com.google.android.exoplayer2.util.AtomicFile</li>
            </ul>
        </li>
    </ul>
    <div class="description">
        <ul class="blockList">
            <li class="blockList">
                <hr>
                <br>
                <pre>public final class <span class="typeNameLabel">AtomicFile</span>
extends java.lang.Object</pre>
                <div class="block">A helper class for performing atomic operations on a file by
                    creating a backup file until a write
                    has successfully completed.

                    <p>Atomic file guarantees file integrity by ensuring that a file has been
                        completely written and
                        sync'd to disk before removing its backup. As long as the backup file
                        exists, the original file
                        is considered to be invalid (left over from a previous attempt to write the
                        file).

                    <p>Atomic file does not confer any file locking semantics. Do not use this class
                        when the file
                        may be accessed or modified concurrently by multiple threads or processes.
                        The caller is
                        responsible for ensuring appropriate mutual exclusion invariants whenever it
                        accesses the file.</div>
            </li>
        </ul>
    </div>
    <div class="summary">
        <ul class="blockList">
            <li class="blockList">
                <!-- ======== NESTED CLASS SUMMARY ======== -->
                <ul class="blockList">
                    <li class="blockList"><a name="nested.class.summary">
                        <!--   -->
                    </a>
                        <h3>Nested Class Summary</h3>
                        <table class="memberSummary" border="0" cellpadding="3" cellspacing="0"
                               summary="Nested Class Summary table, listing nested classes, and an explanation">
                            <caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span>
                            </caption>
                            <tr>
                                <th class="colFirst" scope="col">Modifier and Type</th>
                                <th class="colLast" scope="col">Class and Description</th>
                            </tr>
                            <tr class="altColor">
                                <td class="colFirst"><code>private static class&nbsp;</code></td>
                                <td class="colLast"><code><span class="memberNameLink"><a
                                        href="../../../../../com/google/android/exoplayer2/util/AtomicFile.AtomicFileOutputStream.html"
                                        title="class in com.google.android.exoplayer2.util">AtomicFile.AtomicFileOutputStream</a></span></code>&nbsp;
                                </td>
                            </tr>
                        </table>
                    </li>
                </ul>
                <!-- =========== FIELD SUMMARY =========== -->
                <ul class="blockList">
                    <li class="blockList"><a name="field.summary">
                        <!--   -->
                    </a>
                        <h3>Field Summary</h3>
                        <table class="memberSummary" border="0" cellpadding="3" cellspacing="0"
                               summary="Field Summary table, listing fields, and an explanation">
                            <caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
                            <tr>
                                <th class="colFirst" scope="col">Modifier and Type</th>
                                <th class="colLast" scope="col">Field and Description</th>
                            </tr>
                            <tr class="altColor">
                                <td class="colFirst"><code>private java.io.File</code></td>
                                <td class="colLast"><code><span class="memberNameLink"><a
                                        href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#backupName">backupName</a></span></code>&nbsp;
                                </td>
                            </tr>
                            <tr class="rowColor">
                                <td class="colFirst"><code>private java.io.File</code></td>
                                <td class="colLast"><code><span class="memberNameLink"><a
                                        href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#baseName">baseName</a></span></code>&nbsp;
                                </td>
                            </tr>
                            <tr class="altColor">
                                <td class="colFirst"><code>private static java.lang.String</code>
                                </td>
                                <td class="colLast"><code><span class="memberNameLink"><a
                                        href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#TAG">TAG</a></span></code>&nbsp;
                                </td>
                            </tr>
                        </table>
                    </li>
                </ul>
                <!-- ======== CONSTRUCTOR SUMMARY ======== -->
                <ul class="blockList">
                    <li class="blockList"><a name="constructor.summary">
                        <!--   -->
                    </a>
                        <h3>Constructor Summary</h3>
                        <table class="memberSummary" border="0" cellpadding="3" cellspacing="0"
                               summary="Constructor Summary table, listing constructors, and an explanation">
                            <caption><span>Constructors</span><span class="tabEnd">&nbsp;</span>
                            </caption>
                            <tr>
                                <th class="colOne" scope="col">Constructor and Description</th>
                            </tr>
                            <tr class="altColor">
                                <td class="colOne"><code><span class="memberNameLink"><a
                                        href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#AtomicFile-java.io.File-">AtomicFile</a></span>(java.io.File&nbsp;baseName)</code>
                                    <div class="block">Create a new AtomicFile for a file located at
                                        the given File path.
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </li>
                </ul>
                <!-- ========== METHOD SUMMARY =========== -->
                <ul class="blockList">
                    <li class="blockList"><a name="method.summary">
                        <!--   -->
                    </a>
                        <h3>Method Summary</h3>
                        <table class="memberSummary" border="0" cellpadding="3" cellspacing="0"
                               summary="Method Summary table, listing methods, and an explanation">
                            <caption><span id="t0"
                                           class="activeTableTab"><span>All Methods</span><span
                                    class="tabEnd">&nbsp;</span></span><span id="t2"
                                                                             class="tableTab"><span><a
                                    href="javascript:show(2);">Instance Methods</a></span><span
                                    class="tabEnd">&nbsp;</span></span><span id="t4"
                                                                             class="tableTab"><span><a
                                    href="javascript:show(8);">Concrete Methods</a></span><span
                                    class="tabEnd">&nbsp;</span></span></caption>
                            <tr>
                                <th class="colFirst" scope="col">Modifier and Type</th>
                                <th class="colLast" scope="col">Method and Description</th>
                            </tr>
                            <tr id="i0" class="altColor">
                                <td class="colFirst"><code>void</code></td>
                                <td class="colLast"><code><span class="memberNameLink"><a
                                        href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#delete--">delete</a></span>()</code>
                                    <div class="block">Delete the atomic file.</div>
                                </td>
                            </tr>
                            <tr id="i1" class="rowColor">
                                <td class="colFirst"><code>void</code></td>
                                <td class="colLast"><code><span class="memberNameLink"><a
                                        href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#endWrite-java.io.OutputStream-">endWrite</a></span>(java.io.OutputStream&nbsp;str)</code>
                                    <div class="block">Call when you have successfully finished
                                        writing to the stream returned by <a
                                                href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#startWrite--"><code>startWrite()</code></a>.
                                    </div>
                                </td>
                            </tr>
                            <tr id="i2" class="altColor">
                                <td class="colFirst"><code>java.io.InputStream</code></td>
                                <td class="colLast"><code><span class="memberNameLink"><a
                                        href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#openRead--">openRead</a></span>()</code>
                                    <div class="block">Open the atomic file for reading.</div>
                                </td>
                            </tr>
                            <tr id="i3" class="rowColor">
                                <td class="colFirst"><code>private void</code></td>
                                <td class="colLast"><code><span class="memberNameLink"><a
                                        href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#restoreBackup--">restoreBackup</a></span>()</code>&nbsp;
                                </td>
                            </tr>
                            <tr id="i4" class="altColor">
                                <td class="colFirst"><code>java.io.OutputStream</code></td>
                                <td class="colLast"><code><span class="memberNameLink"><a
                                        href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#startWrite--">startWrite</a></span>()</code>
                                    <div class="block">Start a new write operation on the file.
                                    </div>
                                </td>
                            </tr>
                        </table>
                        <ul class="blockList">
                            <li class="blockList"><a
                                    name="methods.inherited.from.class.java.lang.Object">
                                <!--   -->
                            </a>
                                <h3>Methods inherited from class&nbsp;java.lang.Object</h3>
                                <code>clone, equals, finalize, getClass, hashCode, notify,
                                    notifyAll, toString, wait, wait, wait</code></li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
    <div class="details">
        <ul class="blockList">
            <li class="blockList">
                <!-- ============ FIELD DETAIL =========== -->
                <ul class="blockList">
                    <li class="blockList"><a name="field.detail">
                        <!--   -->
                    </a>
                        <h3>Field Detail</h3>
                        <a name="TAG">
                            <!--   -->
                        </a>
                        <ul class="blockList">
                            <li class="blockList">
                                <h4>TAG</h4>
                                <pre>private static final&nbsp;java.lang.String TAG</pre>
                                <dl>
                                    <dt><span class="seeLabel">See Also:</span></dt>
                                    <dd>
                                        <a href="../../../../../constant-values.html#com.google.android.exoplayer2.util.AtomicFile.TAG">Constant
                                            Field Values</a></dd>
                                </dl>
                            </li>
                        </ul>
                        <a name="baseName">
                            <!--   -->
                        </a>
                        <ul class="blockList">
                            <li class="blockList">
                                <h4>baseName</h4>
                                <pre>private final&nbsp;java.io.File baseName</pre>
                            </li>
                        </ul>
                        <a name="backupName">
                            <!--   -->
                        </a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>backupName</h4>
                                <pre>private final&nbsp;java.io.File backupName</pre>
                            </li>
                        </ul>
                    </li>
                </ul>
                <!-- ========= CONSTRUCTOR DETAIL ======== -->
                <ul class="blockList">
                    <li class="blockList"><a name="constructor.detail">
                        <!--   -->
                    </a>
                        <h3>Constructor Detail</h3>
                        <a name="AtomicFile-java.io.File-">
                            <!--   -->
                        </a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>AtomicFile</h4>
                                <pre>public&nbsp;AtomicFile(java.io.File&nbsp;baseName)</pre>
                                <div class="block">Create a new AtomicFile for a file located at the
                                    given File path. The secondary backup file
                                    will be the same file path with ".bak" appended.
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
                <!-- ============ METHOD DETAIL ========== -->
                <ul class="blockList">
                    <li class="blockList"><a name="method.detail">
                        <!--   -->
                    </a>
                        <h3>Method Detail</h3>
                        <a name="delete--">
                            <!--   -->
                        </a>
                        <ul class="blockList">
                            <li class="blockList">
                                <h4>delete</h4>
                                <pre>public&nbsp;void&nbsp;delete()</pre>
                                <div class="block">Delete the atomic file. This deletes both the
                                    base and backup files.
                                </div>
                            </li>
                        </ul>
                        <a name="startWrite--">
                            <!--   -->
                        </a>
                        <ul class="blockList">
                            <li class="blockList">
                                <h4>startWrite</h4>
                                <pre>public&nbsp;java.io.OutputStream&nbsp;startWrite()
                                throws java.io.IOException</pre>
                                <div class="block">Start a new write operation on the file. This
                                    returns an <code>OutputStream</code> to which you can
                                    write the new file data. If the whole data is written
                                    successfully you <em>must</em> call
                                    <a href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#endWrite-java.io.OutputStream-"><code>endWrite(OutputStream)</code></a>.
                                    On failure you should call <code>OutputStream.close()</code>
                                    only to free up resources used by it.

                                    <p>Example usage:

                                    <pre>
   DataOutputStream dataOutput = null;
   try {
     OutputStream outputStream = atomicFile.startWrite();
     dataOutput = new DataOutputStream(outputStream); // Wrapper stream
     dataOutput.write(data1);
     dataOutput.write(data2);
     atomicFile.endWrite(dataOutput); // Pass wrapper stream
   } finally{
     if (dataOutput != null) {
       dataOutput.close();
     }
   }
 </pre>

                                    <p>Note that if another thread is currently performing a write,
                                        this will simply replace
                                        whatever that thread is writing with the new file being
                                        written by this thread, and when the
                                        other thread finishes the write the new write operation will
                                        no longer be safe (or will be
                                        lost). You must do your own threading protection for access
                                        to AtomicFile.</div>
                                <dl>
                                    <dt><span class="throwsLabel">Throws:</span></dt>
                                    <dd><code>java.io.IOException</code></dd>
                                </dl>
                            </li>
                        </ul>
                        <a name="endWrite-java.io.OutputStream-">
                            <!--   -->
                        </a>
                        <ul class="blockList">
                            <li class="blockList">
                                <h4>endWrite</h4>
                                <pre>public&nbsp;void&nbsp;endWrite(java.io.OutputStream&nbsp;str)
              throws java.io.IOException</pre>
                                <div class="block">Call when you have successfully finished writing
                                    to the stream returned by <a
                                            href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#startWrite--"><code>startWrite()</code></a>.
                                    This will close, sync, and commit the new data. The next attempt
                                    to read the
                                    atomic file will return the new file stream.
                                </div>
                                <dl>
                                    <dt><span class="paramLabel">Parameters:</span></dt>
                                    <dd><code>str</code> - Outer-most wrapper OutputStream used to
                                        write to the stream returned by <a
                                                href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#startWrite--"><code>startWrite()</code></a>.
                                    </dd>
                                    <dt><span class="throwsLabel">Throws:</span></dt>
                                    <dd><code>java.io.IOException</code></dd>
                                    <dt><span class="seeLabel">See Also:</span></dt>
                                    <dd>
                                        <a href="../../../../../com/google/android/exoplayer2/util/AtomicFile.html#startWrite--"><code>startWrite()</code></a>
                                    </dd>
                                </dl>
                            </li>
                        </ul>
                        <a name="openRead--">
                            <!--   -->
                        </a>
                        <ul class="blockList">
                            <li class="blockList">
                                <h4>openRead</h4>
                                <pre>public&nbsp;java.io.InputStream&nbsp;openRead()
                             throws java.io.FileNotFoundException</pre>
                                <div class="block">Open the atomic file for reading. If there
                                    previously was an incomplete write, this will roll
                                    back to the last good data before opening for read.

                                    <p>Note that if another thread is currently performing a write,
                                        this will incorrectly consider
                                        it to be in the state of a bad write and roll back, causing
                                        the new data currently being
                                        written to be dropped. You must do your own threading
                                        protection for access to AtomicFile.</div>
                                <dl>
                                    <dt><span class="throwsLabel">Throws:</span></dt>
                                    <dd><code>java.io.FileNotFoundException</code></dd>
                                </dl>
                            </li>
                        </ul>
                        <a name="restoreBackup--">
                            <!--   -->
                        </a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>restoreBackup</h4>
                                <pre>private&nbsp;void&nbsp;restoreBackup()</pre>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
    <!--   -->
</a>
    <div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation
        links</a></div>
    <a name="navbar.bottom.firstrow">
        <!--   -->
    </a>
    <ul class="navList" title="Navigation">
        <li><a href="../../../../../overview-summary.html">Overview</a></li>
        <li><a href="package-summary.html">Package</a></li>
        <li class="navBarCell1Rev">Class</li>
        <li><a href="package-tree.html">Tree</a></li>
        <li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
        <li><a href="../../../../../index-files/index-1.html">Index</a></li>
        <li><a href="../../../../../help-doc.html">Help</a></li>
    </ul>
</div>
<div class="subNav">
    <ul class="navList">
        <li><a href="../../../../../com/google/android/exoplayer2/util/Assertions.html"
               title="class in com.google.android.exoplayer2.util"><span class="typeNameLink">Prev&nbsp;Class</span></a>
        </li>
        <li>
            <a href="../../../../../com/google/android/exoplayer2/util/AtomicFile.AtomicFileOutputStream.html"
               title="class in com.google.android.exoplayer2.util"><span class="typeNameLink">Next&nbsp;Class</span></a>
        </li>
    </ul>
    <ul class="navList">
        <li><a href="../../../../../index.html?com/google/android/exoplayer2/util/AtomicFile.html"
               target="_top">Frames</a></li>
        <li><a href="AtomicFile.html" target="_top">No&nbsp;Frames</a></li>
    </ul>
    <ul class="navList" id="allclasses_navbar_bottom">
        <li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
    </ul>
    <div>
        <script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->


        </script>
    </div>
    <div>
        <ul class="subNavList">
            <li>Summary:&nbsp;</li>
            <li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
            <li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
            <li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
            <li><a href="#method.summary">Method</a></li>
        </ul>
        <ul class="subNavList">
            <li>Detail:&nbsp;</li>
            <li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
            <li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
            <li><a href="#method.detail">Method</a></li>
        </ul>
    </div>
    <a name="skip.navbar.bottom">
        <!--   -->
    </a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
